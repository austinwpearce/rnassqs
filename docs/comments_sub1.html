<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Reviewer 1 Comments • rnassqs</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>



<meta property="og:title" content="Reviewer 1 Comments" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rnassqs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/rnassqs.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/potterzot/rnassqs">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Reviewer 1 Comments</h1>
    </div>


<div id="reviewer-1-comments" class="section level1">

<ul>
<li><p><input type="checkbox" disabled>
Spell check the package, in particular the DESCRIPTION file’s Line 12, Agricultre</p></li>
<li><p><input type="checkbox" disabled checked>
I feel a bit like the functionality for the end-user is a bit overly complicated. This sort of package to me should just return data in a data.frame or list or some other R object that I can easily work with. In some cases I get a server response, in others I can ask for raw JSON or other file formats. I don’t really see a good reason for this in R. I guess the functionality could be offered, but I think it needs to be hidden under a few layers for more advanced users that might want to use it. Rather it should just be a simple query for the data that I want and returning it in a format that I can readily use in R without extra steps. Just fetch the data and format it for me in one single step. I think it’s possible with this package, but the documentation is a bit convoluted and not clear to me.</p></li>
<li><p><input type="checkbox" disabled checked>
It is entirely up to the package authors how to organise the functions, but I find the current structure confusing at best. Typically when I see a file with just the package name, it is just there to provide the help file for the package with author information, references and other basic info. The nassqs.R file has several functions in it for the package along with release_questions(), which I find to be extremely odd. This function is not something that should be in the package and exposed to end-users. My suggestion is remove release_questions() entirely and split out the functions into their own files with the function name being the file-name. This helps make it easier to keep the functions organised and updated. Splitting the functions out is entirely up to the authors if they wish to implement this structure, however I feel that removing release_questions() is necessary.</p></li>
<li><p><input type="checkbox" disabled checked>
Any functions that query an external server for data and may fail or take an extended period of time to run should have the examples wrapped in a \donttest{} for CRAN but still allowing for local testing. I see most examples are wrapped but not all that run an external query.</p></li>
<li><p><input type="checkbox" disabled checked>
Documentation for nassqs_GET() is confusing. The example returns a response object, which is weird. What do I do with this response value? How is this response yields for corn in 2012 in Washington? Does the end-user even need to interface with this function or should it be hidden and used by the other functions in the package that return data in data.frames or other R objects?</p></li>
<li><p><input type="checkbox" disabled checked>
nassqs_parse() as is unclear. It states it indicates the data type returned, but doesn’t list the data types aside from in the usage section, which indicates that a list is possible, but this doesn’t appear to be documented? The @return section says a data frame or raw text of the content from the request.</p></li>
<li><p><input type="checkbox" disabled checked>
All exported functions should have examples in the documentation, nassqs_check() does not have any examples.</p></li>
<li><p><input type="checkbox" disabled checked>
nassqs_params() lacks examples</p></li>
<li><p><input type="checkbox" disabled checked>
It’s a bit of opsec, but I think the README and vignette should be more explicit about keeping the API keys secret and not embedding them in scripts. Along with this, highlighting why it’s useful to use the .Renviron file for this purpose would be nice (you don’t have to worry about adding it to .gitignore for one). For new users just how to modify the .Renviron is likely to be confusing at best and frustrating at worst. Perhaps it would be nice to include an example that shows how to use usethis::edit_r_environ() for this purpose to streamline the illustrations and examples.</p></li>
<li><p><input type="checkbox" disabled checked>
NOT NECESSARY The DESCRIPTION file’s description text might need " ’ " around “API”. I had to do this for the nasapower package to have it accepted on CRAN.</p></li>
<li><p><input type="checkbox" disabled checked>
I always encourage including a proper CITATION file in /inst, see <a href="https://github.com/ropensci/nasapower/blob/master/inst/CITATION" class="uri">https://github.com/ropensci/nasapower/blob/master/inst/CITATION</a> for an example</p></li>
<li><p><input type="checkbox" disabled checked>
The paper.md file has Git conflicts in it that need to be resolved</p></li>
<li><p><input type="checkbox" disabled checked>
There is no statement about contributions or a code-of-conduct present</p></li>
<li>
<p><input type="checkbox" disabled checked>
When I try using the nassqs_token() I receive and error message.</p>
<blockquote>
<p>library(rnassqs) nassqs_token() Error in nassqs_token() : could not find function “nassqs_token”</p>
</blockquote>
</li>
<li><p><input type="checkbox" disabled checked>
Remove nassqs_fields() from vignette</p></li>
<li><p><input type="checkbox" disabled checked>
Remove nassqs_field_values() from vignette</p></li>
<li><p><input type="checkbox" disabled checked>
(Retaining GET as per httr, fixing PARSE) Function names are not consistent with GET being all caps but parse and check not. In the vignette text nassqs_parse() is referred to as PARSE in all caps. Consistency in function naming will help the end user.</p></li>
<li><p><input type="checkbox" disabled checked>
Why is base_URL given as a parameter that the user can modify? The documentation even says it “probably” should not be changed. I would just hard-code it and not give the user any possibility of changing it. I can’t see any good reason for doing this. If the URL changes, then the package should be updated to reflect the changes.</p></li>
<li><p><input type="checkbox" disabled checked>
When packages are mentioned in the documentation, wrap them in \pkg{httr} for proper formatting to indicate that you are referring to a package. Likewise, R can be written as \R for special formatting.</p></li>
<li><p><input type="checkbox" disabled checked>
The text \code{jsonlite::fromJSON} should be written as \code{\link[jsonlite]{fromJSON}} so that it links to the help file for this function.</p></li>
<li><p><input type="checkbox" disabled checked>
Titles for function help files should be written in title case.</p></li>
<li><p><input type="checkbox" disabled checked>
The example for nassqs_param_values() is commented out making it difficult to follow.</p></li>
<li><p><input type="checkbox" disabled checked>
The example for nassqs_parse() could be easier to follow.</p></li>
</ul>
<div id="comments-on-code-style" class="section level2">
<h2 class="hasAnchor">
<a href="#comments-on-code-style" class="anchor"></a>Comments on code style</h2>
<ul>
<li>
<input type="checkbox" disabled checked>
In most cases the code is clearly written, in some cases the style is inconsistent with lack of spaces around a “=”, e.g. Line 73 of nassqs.R. This also applies in the examples for documentation. Also, single and double quotes are used interchangeably. I find it easier to follow if only one style is used in all cases as there are cases where single quotes only may be used and so forth and so on.</li>
<li>
<input type="checkbox" disabled checked>
Wrap code at 80 characters for ease of reading and for those of us that don’t have editor windows that expand beyond 80 chars wide.</li>
<li>
<input type="checkbox" disabled checked>
The operator used to assign in the examples also switches between = and &lt;-. Only one should be used consistently.</li>
</ul>
</div>
</div>
<div id="reviwer-2-comments" class="section level1">
<h1 class="hasAnchor">
<a href="#reviwer-2-comments" class="anchor"></a>Reviwer 2 Comments</h1>
<ul>
<li>
<input type="checkbox" disabled>
Style and code-hygiene comments aside, my main suggestion to you is to think about how you can orient the package towards the R user and their needs. The purpose of this package should be to encapsulate your hard-earned knowledge of how this API works and enable data scientists to access that data as naturally as possible. However, the package currently seems to expose an R interface centered around the needs of the API and not the R user. For example, the functions that seem to make up the public interface for the package are mostly stuck in “helpers.R”, as if they’re ancillary when really they should be front and center.</li>
</ul>
<p>Here’s a more concrete example: reading the vignette discussion about the comparison operators, it looks like the way to get data on corn production in Virginia since 2012 is</p>
<p>nassqs(list(commodity_desc=“CORN”, year__GE=2012, state_alpha=“VA”))) But when I think about the R code that I want to type to get that data, it looks more like</p>
<p>nassqs(commodity == “corn”, state == “va”, year &gt;= 2012) That is, not case-sensitive, handles the different ways commodities and states (for example) could be referenced (integer code, abbreviation, long name), and more naturally handles the comparison operators (can translate year &gt;= 2012 to year__GE=2012). You could go even farther and have a dplyr syntax where you can filter() rows and select() columns, so that the R user is essentially describing the data.frame they want to get, and your package figures out how to turn that into API requests, handle pagination, etc., and return the shape of data that an R user expects.</p>
<p>I’m not saying you need to do exactly this/all of this now (though some things, like case insensitvity, would be easy enough), but more to suggest ideas for the future and to show what I mean in terms of thinking of the R interface and not just what the API demands. When I wrap APIs (and in general write packages), I like to start by thinking about the R code I want (users) to type, and that usually means doing more work in the package to mask the awkwardness of the underlying HTTP API.</p>
<ul>
<li><p><input type="checkbox" disabled checked>
Another way to get more R-user-centric would be to improve the documentation, which I found to be thin, often tautological (@param api_path the API path), and not helpful for an inexperienced user. Documentation is a bit of work but it’s worth doing, especially for how it can help focus you on what the intended user needs to know in order to get value from the package–and how you can make what details they need to know as minimal as possible.</p></li>
<li><p><input type="checkbox" disabled>
A good way to see what the docs will look like to your users is to use pkgdown to build the package website. You don’t need to publish this (though it’s nice if you do), but I’ve found that even doing it locally makes it really visible to me where my documentation is not the most helpful or beautiful.</p></li>
</ul>
<p>Observations from using the package I got a token and did the example on the readme (corn yields in Virginia and Pennsylvania for since 2000).</p>
<blockquote>
<p>library(rnassqs) Sys.setenv(NASSQS_TOKEN=“REDACTED”) params &lt;- list(“commodity_desc”=“CORN”,</p>
</blockquote>
<ul>
<li><div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>              <span class="st">"year__GE"</span>=<span class="dv">2000</span>,</span></code></pre></div></li>
<li><div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>              <span class="st">"state_alpha"</span>=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VA"</span>, <span class="st">"PA"</span>),</span></code></pre></div></li>
<li>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>              <span class="st">"statisticcat_desc"</span>=<span class="st">"YIELD"</span><span class="er">)</span></span></code></pre></div>
<blockquote>
<p>df &lt;- nassqs(params) That all worked as expected. That said,</p>
</blockquote>
</li>
<li>
<input type="checkbox" disabled>
It was pretty slow. Slow enough that I wondered if the process was hung. The resulting data.frame is 4752 x 39, so not huge. I’m not sure what was slow, but it might be worth considering how to show progress. I believe httr has some tools for showing progress if it’s slow because of the network, for example. But maybe network isn’t the constraint. Granted, I made one request, so I’m not sure how widespread the issue is, but it was distracting.</li>
</ul>
<p>It was not at all obvious to me that I would get 39 columns back. It would help if the documentation perhaps described the result, beyond saying “returns a data frame”. And is it possible to request fewer columns? Some are clearly duplicate information (state_name, state_alpha).</p>
<ul>
<li><p><input type="checkbox" disabled>
It’s odd to me that year is numeric but everything else in the data.frame is character, even when there are very obviously numeric columns in there. If I’m going to do anything useful with this crop yield data I just downloaded, the first thing I’m going to have to do is df$Value &lt;- as.numeric(df$Value) so it seems worthwhile to return properly formatted data.</p></li>
<li><p><input type="checkbox" disabled>
It was surprising that the one column name that the package code changes gets a rather unfriendly name (“CV (%)”), while the other columns follow a standard, well-behaved format.</p></li>
</ul>
<p>Specific code notes General style</p>
<ul>
<li>
<input type="checkbox" disabled checked>
Give documentation for what those params mean? Or link to API docs?</li>
<li>
<input type="checkbox" disabled checked>
Check out markdown formatting in roxygen2: will clean up your \code{\link{}}s</li>
<li>
<input type="checkbox" disabled checked>
nass_auth: IMO this function should just be function (key) Sys.setenv(NASSQS_TOKEN = key). What’s the value of the interactive mode? It’s reasonable to expect user to set auth at the beginning of the session.</li>
<li>
<input type="checkbox" disabled checked>
Not sure the dual purpose (set and get token) is worth it. In places where you want to read the token, just Sys.getenv()</li>
<li>
<input type="checkbox" disabled checked>
I’d remove key from the function signature and just Sys.getenv(). L75-78 is unnecessary complexity</li>
<li>
<input type="checkbox" disabled checked>
A nicer interface would accept the “params” as … rather than require you to wrap them in list() yourself. I don’t think you need to pass … to nassqs_GET (if any of its args are important to expose, add them as named arguments)</li>
<li>
<input type="checkbox" disabled checked>
don’t need to quote/backtick list names (unless there’s a space, which isn’t the case anywhere here) e.g. prefer list(param=param) over list(“param”=param) (JSON etc.) are not.</li>
<li>
<input type="checkbox" disabled checked>
#’ @importFrom httr function_name rather than httr::function_name</li>
<li>
<input type="checkbox" disabled checked>
if (something) { result } inline is bad form: either drop {} or make multiline. See <a href="https://style.tidyverse.org/syntax.html#indenting" class="uri">https://style.tidyverse.org/syntax.html#indenting</a>
</li>
<li>
<input type="checkbox" disabled checked>
can do nassqs_fields &lt;- nassqs_params, don’t need function () that()</li>
<li>
<input type="checkbox" disabled checked>
Agree that release_questions() doesn’t belong in the package</li>
<li>
<input type="checkbox" disabled checked>
L127 docs not correct since it doesn’t necessarily return a data frame</li>
<li>
<input type="checkbox" disabled checked>
“as” list is different from nassqs</li>
<li>
<input type="checkbox" disabled checked>
as “raw” is misleading; it’s not raw in the R sense, it’s “character”. or as=“text” if you want to be like httr</li>
<li>
<input type="checkbox" disabled checked>
L153: when is not a response object? Also better to use inherits() rather than class ==. Also can return() early rather than if/else</li>
<li>
<input type="checkbox" disabled checked>
L159 warning: can’t be tested because if condition is met, L156 would have errored. Suggests better test coverage needed</li>
<li>
<input type="checkbox" disabled checked>
L177 read.csv</li>
<li>
<input type="checkbox" disabled checked>
L179: no else case?</li>
<li>
<input type="checkbox" disabled checked>
L214 don’t need to end lines with ; nassqs (and mostly relevant for helpers.R functions too)</li>
<li>
<input type="checkbox" disabled checked>
nassqs Is this the function people should be calling? If so, the file would be more readable if you put this function at the top of the file Related, you can use @inheritParams to document the function args in only one place and pull them in in the other functions that have the same</li>
<li>
<input type="checkbox" disabled checked>
nassqs_GET L35 docs: make that an href</li>
<li>
<input type="checkbox" disabled checked>
I’d remove base_url from the signature (since it “should probably never be changed”). If you want it configurable for some reason, allow it to be set by an option and in the function get it like base_url &lt;- getOption(“rnasssqs.base_url”, “<a href="https://quickstats.nass.usda.gov/api/" class="uri">https://quickstats.nass.usda.gov/api/</a>”)</li>
<li>
<input type="checkbox" disabled checked>
I’d remove url_only from the signature. It’s confusing to have a function than can return very different things based on an argument. If that’s functionality you need, I’d factor out the URL query assembly, ending in build_url(), to its own function, and have rnassqs_GET() call that and then httr::GET() the result. If you only have this argument for unit testing, I have an alternative proposal (see below).</li>
<li>
<input type="checkbox" disabled checked>
It’s odd that the function allows “XML” format but rnassqs_parse errors if it gets XML.</li>
<li>
<input type="checkbox" disabled checked>
Consider removing “format” from the signature altogether since it can be set in params. Also, why would I care what content-type I’m querying in if my end result is going to be a data.frame?</li>
<li>
<input type="checkbox" disabled checked>
nassqs_check: what do I do if my request is too large? Give some recommendation for how to fix it. If it means that you need to make paginated requests, how would I do that? An even friendlier solution would be for you to handle the pagination for the user so they don’t need to know/care about this API constraint. helpers.R</li>
<li>
<input type="checkbox" disabled checked>
expand_list() is probably the only function there that fits with what I’d expect helpers to be (i.e. internal functions). I’d give it @keywords internal so it doesn’t list in the help index, and possibly just document it with comments and not formal documentation. (And if you’re going to document it, explain what it actually does, which is not obvious.) Vignette</li>
<li>
<input type="checkbox" disabled checked>
.secret file is used in tests and supporting code, and it’s discussed in the vignette, but it’s not actually supported in the package (i.e. the nassqs_auth() doesn’t look for a .secret file). And IIUC the vignette recommendation is incomplete: you’d still have to set or pass it in even if you read it in with readLines(). IMO I’d just drop that discussion and rely on the environment variable, or say that if you wanted to store it in some file (called whatever), you could read it and set it in your session like Sys.setenv(NASSQS_TOKEN = readLines(file)).</li>
<li>
<input type="checkbox" disabled checked>
Don’t rnassqs:: your own functions, not necessary</li>
<li>
<input type="checkbox" disabled checked>
Looks like you should Suggest assertthat since your vignette uses it.</li>
</ul>
<p>Tests oncran</p>
<ul>
<li>
<input type="checkbox" disabled>
You may find the httptest package useful for these tests. Rather than using the url_only argument (which I suspect you only have for tests), you could use expect_GET(nassqs(…), url) httptest would also let you supply mock responses so you could test the full request/response/parse flow naturally. What you have with the the .rds testdata files works, of course, but httptest could make those tests more readable and maintainable. FYI there is testthat::skip_if(), and you could of course define your own skip_if_interactive() (but you take my suggestion to drop the interactive behavior of the auth function, then you can just delete these tests) withr::with_envvar can help manipulate environment variables within tests (withr is depended on by testthat, so it’s a “free” dependency, in case that’s a concern)</li>
<li>
<input type="checkbox" disabled>
L133-151: maybe you want one of these to assert that you can get the “text” content, but mostly you’re just asserting that httr::content() works.</li>
</ul>
<p>local</p>
<ul>
<li>
<input type="checkbox" disabled>
Again, I’d drop the .secret file (and thus the here dependency)</li>
<li>
<input type="checkbox" disabled>
L37: is.numeric(as.numeric(…)) is always true so this test doesn’t do anything; also for future reference, testthat::expect_true may help in some places</li>
<li>
<input type="checkbox" disabled>
L56: httptest would let you test handling of error responses without a network connection</li>
</ul>
<p>Miscellaneous</p>
<ul>
<li>
<input type="checkbox" disabled checked>
Should add stats and utils to Imports in DESCRIPTION</li>
<li>
<input type="checkbox" disabled>
R CMD check shows this NOTE–maybe because the file is huge? Consider (re)moving the link, obfuscating it so that CRAN doesn’t try to download it, or something. Found the following (possibly) invalid URLs: URL: <a href="ftp://ftp.nass.usda.gov/quickstats" class="uri">ftp://ftp.nass.usda.gov/quickstats</a> From: README.md Status: Error Message: libcurl error code 6: Could not resolve host: ftp.nass.usda.gov</li>
<li>
<input type="checkbox" disabled checked>
Would be good to add rnassqs.Rcheck and rnassqs_*.tar.gz to .Rbuildignore and .gitignore so that artifacts from R CMD build and check locally don’t get checked in</li>
<li>
<input type="checkbox" disabled checked>
.Rbuildignore includes a misspelling (paoer.pdf)</li>
</ul>
</div>


  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicholas Potter.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

