<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Response to Reviewers • rnassqs</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>



<meta property="og:title" content="Response to Reviewers" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rnassqs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/rnassqs.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/potterzot/rnassqs">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Response to Reviewers</h1>
    </div>


<p><strong>Question</strong>: Since both reviewers recommend removing <code>release_questions()</code>, where is it recommended that it go? These are helpful (for me) pre-release questions and the function is suggested by the R Packages book (<a href="http://r-pkgs.had.co.nz/release.html">here</a>), but it doesn’t suggest where to put it.</p>
<div id="response-to-reviewers" class="section level1">

<p>The reviewers raise some excellent points to consider about usability and organization. The package feels greatly improved by virtue of their comments and suggestions. Thank you!</p>
<p>Below I detail some more general thoughts that were raised by the reviewers and my response, and then detail specific response to each reviewer separately.</p>
<div id="data-size-and-usability" class="section level4">
<h4 class="hasAnchor">
<a href="#data-size-and-usability" class="anchor"></a>Data size and usability</h4>
<p>One reviewer suggestion was to improve the interface to make it more user friendly, i.e. that the package seemed to be built around the needs of the API rather than the needs of the user. To some extent this is a function of the inflexibility of the API itself. A data request to the Quick Stats API returns JSON that, when parsed to a data.frame, results in a data.frame that has 39 columns. Unfortunately there is no way to limit the number of columns returned. The idea of being able to <code>select</code> a la <code>dplyr</code> is awesome, but since all 39 columns must be returned, it seems best to leave it to the user to <code>select</code> after the call is made.</p>
</div>
<div id="parameter-passing" class="section level4">
<h4 class="hasAnchor">
<a href="#parameter-passing" class="anchor"></a>Parameter passing</h4>
<p>In response to suggestions about parameters and user experience I’ve made two changes. The first allows for specifying either a list of parameters in <code>nassqs</code> as was the previous case, or specifying each parameter as a separate argument to <code>nassqs</code>, as was suggested by @nealrichardson. In addition, I’ve added links to parameter documentation in the API, and now <code><a href="reference/nassqs_params.html">nassqs_params()</a></code> returns a list of parameters, while <code><a href="reference/nassqs_params.html">nassqs_params("agg_level_desc")</a></code> returns a description of the “agg_level_desc” parameter. I’ve also updated the vignette to show both methods.</p>
</div>
<div id="pagination-and-handling-requests-larger-than-50000-records" class="section level4">
<h4 class="hasAnchor">
<a href="#pagination-and-handling-requests-larger-than-50000-records" class="anchor"></a>Pagination and handling requests larger than 50,000 records</h4>
<p>The question of pagination came up repeatedly. It’s an interesting one in the context of this API. There is not a direct way to paginate results that the API supports. Typically I end up subsetting by year or geography to make the query small enough. <code>rnassqs</code> could try to subset by year or geography automatically, perhaps with a series of rules that first subset by year and if only one year is requested or the request is too large, then also subsetting by a smaller geography. However, there are potential issues here. For example, a state-level request will not necessarily result in the same data as collecting all counties for that state for two reasons:</p>
<ol>
<li>Some data are collected at the state level only</li>
<li>County-level data may be suppressed where the state level data is not</li>
</ol>
<p>Automatically subsetting by year would be doable though. I have added an issue for a future release to do so. In the meantime I have also added information in the error message to suggest how to subset the query.</p>
</div>
<div id="non-specific-changes" class="section level3">
<h3 class="hasAnchor">
<a href="#non-specific-changes" class="anchor"></a>Non-specific changes</h3>
<ul>
<li>Added reviewers to the DESCRIPTION with role = ‘rev’</li>
<li>Fixed spelling errors (sorry)</li>
<li>Removed <code>release_questions()</code> (but see question at the top of this response)</li>
</ul>
</div>
<div id="response-to-reviewer-1" class="section level2">
<h2 class="hasAnchor">
<a href="#response-to-reviewer-1" class="anchor"></a>Response to Reviewer 1</h2>
<p>@adamhsparks provided some excellent feedback on issues of usability and potential unnecessary complexity. In particular, this comment was helpful.</p>
<blockquote>
<p>I feel a bit like the functionality for the end-user is a bit overly complicated. This sort of package to me should just return data in a data.frame or list or some other R object that I can easily work with. In some cases I get a server response, in others I can ask for raw JSON or other file formats. I don’t really see a good reason for this in R. I guess the functionality could be offered, but I think it needs to be hidden under a few layers for more advanced users that might want to use it. Rather it should just be a simple query for the data that I want and returning it in a format that I can readily use in R without extra steps. Just fetch the data and format it for me in one single step. I think it’s possible with this package, but the documentation is a bit convoluted and not clear to me. There seem to be two major and related issues</p>
</blockquote>
<p>While it’s true that the package contains <code>nassqs</code>, which will just simply query and return a data.frame object without the user having to specify anything, I have reorganized and rewritten the documentation and vignette to emphasize <code>nassqs</code> rather than the low-level functions <code>nassqs_GET</code> and <code>nassqs_parse</code>. I have added documentation and changed the vignette to focus on the ease of use aspect, rather than on building a query using the core functions.</p>
<p>The second issue concerned the organization of functions. I have reorganized functions into files by collective functionality, in an effort to meet the guidelines suggested in <a href="http://r-pkgs.had.co.nz/r.html">R Packages</a>, which states</p>
<blockquote>
<p>While you’re free to arrange functions into files as you wish, the two extremes are bad: don’t put all functions into one file and don’t put each function into its own separate file.</p>
</blockquote>
<p>Now functions dealing with the request and parsing of the request are in <code>request.R</code>. Authorization functions are in <code>auth.R</code>. Helpers are in <code>helpers.R</code>. Functions dealing with parameters and parameter values are in <code>params.R</code>. Functions that make queries easier are in <code>wrappers.R</code>. I think this strikes a good balance, but am certainly open to suggestions to make this clearer if needed.</p>
<div id="specific-items" class="section level3">
<h3 class="hasAnchor">
<a href="#specific-items" class="anchor"></a>Specific Items</h3>
<div id="general-package" class="section level4">
<h4 class="hasAnchor">
<a href="#general-package" class="anchor"></a>General package</h4>
<ul>
<li>Clarified keeping the API key in the <code>.Renviron</code> file in the README and vignette</li>
<li>Added a CITATION file, though it has placeholders until/if the article is accepted by JOSS</li>
<li>Resolved GIT merge conflicts in paper.md</li>
<li>contributing and code of conduct text added in CONTRIBUTING.md and CONDUCT.md, as well as in the README</li>
</ul>
</div>
<div id="vignette" class="section level4">
<h4 class="hasAnchor">
<a href="#vignette" class="anchor"></a>Vignette</h4>
<ul>
<li>Fixed references to <code><a href="reference/nassqs_fields.html">nassqs_fields()</a></code> in the vignette, which now refer to <code>nassqs_param()</code>
</li>
<li>Fixed error with <code>nassqs_field_values()</code> in the vignette</li>
<li>Fixed inconsistencies with ‘PARSE’ in the vignette</li>
</ul>
</div>
<div id="code" class="section level4">
<h4 class="hasAnchor">
<a href="#code" class="anchor"></a>Code</h4>
<ul>
<li>I did not change the case of <code>nassqs_GET</code>, based on style guidelines from the <code>httr</code> package: <a href="https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html">Best practices for API packages</a>
</li>
<li>removed <code>base_url</code> as a parameter in <code>nassqs_GET</code>
</li>
</ul>
</div>
<div id="code-style" class="section level4">
<h4 class="hasAnchor">
<a href="#code-style" class="anchor"></a>Code Style</h4>
<ul>
<li>Fixed inconsistencies with “=” and “&lt;-”</li>
<li>All code lines are 80 characters or less</li>
</ul>
</div>
<div id="documentation" class="section level4">
<h4 class="hasAnchor">
<a href="#documentation" class="anchor"></a>Documentation</h4>
<ul>
<li>Fixed incorrect reference to jsonlite::fromJSON</li>
<li>Fixed link to utils::read.table</li>
<li>Added “\code{\link[]{}}” for linking to function documentation.</li>
<li>I did not change function titles to title case based on the examples from the ‘R Packages’ [documentation chapter]](<a href="http://r-pkgs.had.co.nz/man.html" class="uri">http://r-pkgs.had.co.nz/man.html</a>)</li>
<li>Added an example to <code><a href="reference/nassqs_params.html">nassqs_params()</a></code>
</li>
<li>Fixed example for <code><a href="reference/nassqs_param_values.html">nassqs_param_values()</a></code>
</li>
<li>Fixed inconsistencies between use of single and double quotes, though note that I use single quotes to refere to keys in a list or object, and double quotes to refer to strings.</li>
<li>wrapped all examples that make an API call in ‘\donttest’</li>
<li>Clarified documentation and examples in ‘nassqs_GET’ to specify that it is a low-level function</li>
<li>Clarified documentation in ‘nassqs_parse’ to better explain what it does and why</li>
</ul>
</div>
</div>
</div>
<div id="response-to-reviewer-2" class="section level2">
<h2 class="hasAnchor">
<a href="#response-to-reviewer-2" class="anchor"></a>Response to Reviewer 2</h2>
<p>@nealrichardson brought up several excellent points about the API and especially about testing and ease of use and focusing on the needs of the user. I feel it is easier to define a list of parameters and submit that as a single argument to <code>nassqs</code>, especially for example when iterating over a collection of queries. However, I recognize both needs, and have made it possible to call <code>nassqs</code> in either of two ways:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># First method, a named list of parameters</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">agg_level_desc =</span> <span class="st">"STATE"</span>,</span>
<span id="cb1-3"><a href="#cb1-3"></a>               <span class="dt">state_alpha =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VA"</span>, <span class="st">"WA"</span>))</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="reference/nassqs.html">nassqs</a></span>(params)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># Second method, separate arguments</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw"><a href="reference/nassqs.html">nassqs</a></span>(<span class="dt">agg_level_desc =</span> <span class="st">"STATE"</span>, <span class="dt">state_alpha =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"VA"</span>, <span class="st">"WA"</span>))</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># Or without capitalizing</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw"><a href="reference/nassqs.html">nassqs</a></span>(<span class="dt">agg_level_desc =</span> <span class="st">"state"</span>, <span class="dt">state_alpha =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"va"</span>, <span class="st">"wa"</span>))</span></code></pre></div>
<p>I have expanded the vignette to demonstrate both methods and to emphasize the iteration and pagination of data available by iterating over a list of parameter lists.</p>
<p>Many of @nealrichardson’s suggestions involve simplifying the interface, and I think the new function calls are much improved in this regard. These suggests were a real gem. Authorization is simpler, functions have fewer and simpler arguments, and overall ease of use is improved. His suggestion of allowing <code>year &gt;= 2012</code> instead of (or in addition to) <code>year__GE = 2012</code> is also a good one. I have not implemented it here because I suspect <code>LIKE</code> and <code>NOT LIKE</code> would be slightly more difficult. I have created an issue to implement this in a future release.</p>
<p>Another concern was that all data is in character format rather than numeric for columns that are numeric. The reason is that the Quick Stats data lists suppressed or unavailable information in a variety of character-based ways. As a result the <code>Value</code> field may contain “(D)”, “(Z)”, or “(S)” rather than numbers. Converting to numeric makes these values <code>NA</code>, which loses the specific information about why the data is missing. It is true that it is easy enough to convert to numerical format, but in my opinion keeping this information about why data is missing is important.</p>
<p>The <code>httptest</code> package is a huge help and I wish I had known about it when I was asking on twitter about API testing months ago. I’ve reorganized and updated the tests to use mock API calls, and also with tests in test files that correspond to the function file names in the <code>R</code> directory. For example, <code>test-requests.R</code> contains tests for functions in <code>R/request.R</code>.</p>
<div id="specific-items-1" class="section level3">
<h3 class="hasAnchor">
<a href="#specific-items-1" class="anchor"></a>Specific Items</h3>
<div id="general" class="section level4">
<h4 class="hasAnchor">
<a href="#general" class="anchor"></a>General</h4>
<ul>
<li>Added ‘assertthat’ to Suggests in DESCRIPTION</li>
<li>Added stats and utils to Imports in DESCRIPTION</li>
<li>Added rnassqs.Rcheck and rnassqs_*.tar.gz to .Rbuildignore and .gitignore</li>
<li>Added case insensitivity</li>
<li>Converted documentation to markdown format</li>
<li>Improved documentation generally, especially for parameter definitions</li>
<li>Added a package web site with <code>pkgdown</code>
</li>
</ul>
</div>
<div id="code-1" class="section level4">
<h4 class="hasAnchor">
<a href="#code-1" class="anchor"></a>Code</h4>
<ul>
<li>Moved <code>nassqs</code> to top of file since it is the main function</li>
<li>Fixed <code>nassqs_fields &lt;- nassqs_params</code>
</li>
<li>In <code>nassqs_GET</code>, removed <code>url_only</code> and <code>format</code> as function parameters</li>
<li>In <code>nassqs_parse</code>, used <code>inherits</code> rather than <code>class() ==</code>.</li>
<li>In <code>nassqs_parse</code> RE: “L153: when is not a response object?”, at times the API is not working, so in that case this returns the error message directly.</li>
<li>In <code>nassqs_parse</code>, removed unreachable warning</li>
<li>In <code>nassqs_parse</code>, added else case and changed <code>read.table</code> to <code>read.csv</code>
</li>
<li>In <code>nassqs</code> and <code>nassqs_parse</code>, change ‘raw’ to ‘text’ as an option for the <code>as</code> parameter</li>
<li>In <code>nassqs_check</code>, RE: “what do I do if my request is too large? Give some recommendation for how to fix it. If it means that you need to make paginated requests, how would I do that? An even friendlier solution would be for you to handle the pagination for the user so they don’t need to know/care about this API constraint.”</li>
<li>In <code>expand_list</code>, added @keywords internal and expanded with a description of what it does and why.</li>
<li>In <code><a href="reference/nassqs_auth.html">nassqs_auth()</a></code>, now <code>nassqs_GET</code> checks for the environmental variable <code>NASSQS_TOKEN</code>, and <code>nassqs_auth</code> simply sets that token.</li>
</ul>
</div>
<div id="code-style-1" class="section level4">
<h4 class="hasAnchor">
<a href="#code-style-1" class="anchor"></a>Code Style</h4>
<ul>
<li>Fixed inline if statements: <code>if() { }</code> by removing braces</li>
<li>Regarding this comment: ‘@importFrom httr function_name rather than httr::function_name’, <a href="">R Packages</a> generally recommends using the “::” version since it makes clear what package the function is coming from, with the exception that it makes things very slightly slower. However, the vast amount of time in the GET request is due to the API service, so in this case using “::” makes sense to me</li>
<li>Removed quotes from list names</li>
</ul>
</div>
<div id="vignette-1" class="section level4">
<h4 class="hasAnchor">
<a href="#vignette-1" class="anchor"></a>Vignette</h4>
<ul>
<li>Removed <code>rnassqs::</code> from functions</li>
<li>Removed <code>.secret</code> and references to it.</li>
</ul>
</div>
<div id="tests" class="section level4">
<h4 class="hasAnchor">
<a href="#tests" class="anchor"></a>Tests</h4>
<ul>
<li>Removed use of <code>.secret</code> for testing</li>
<li>Reorganized tests to match the file names of the functions they are testing</li>
<li>Make use of <code><a href="https://enpiar.com/r/httptest/reference/with_mock_api.html">httptest::with_mock_api</a></code>
</li>
</ul>
</div>
</div>
</div>
</div>


  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicholas Potter.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

